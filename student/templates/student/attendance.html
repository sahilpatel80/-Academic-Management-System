{% extends 'student/base.html' %}
{% load static %}

{% block title %}
  Attendance | Academic Cloud
{% endblock %}

{% block header_title %}
  My Attendance
{% endblock %}

{% block sidebar_menu %}
  <a href="{% url 'student:student_dashboard' %}" class="flex items-center gap-3 px-6 py-3 text-[#616f89] hover:bg-gray-50 transition-colors">
    <span class="material-symbols-outlined">dashboard</span>
    <span class="font-medium text-sm">Dashboard</span>
  </a>

  <a href="{% url 'student:attendance' %}" class="flex items-center gap-3 px-6 py-3 bg-blue-50/50 text-primary border-r-4 border-primary transition-colors">
    <span class="material-symbols-outlined font-variation-settings-'FILL'-1">event_available</span>
    <span class="font-medium text-sm">Attendance</span>
  </a>

  <a href="{% url 'student:exam_results' %}" class="flex items-center gap-3 px-6 py-3 text-[#616f89] hover:bg-gray-50 transition-colors">
    <span class="material-symbols-outlined">assignment</span>
    <span class="font-medium text-sm">Grades</span>
  </a>

  <a href="{% url 'student:profile' %}" class="flex items-center gap-3 px-6 py-3 text-[#616f89] hover:bg-gray-50 transition-colors">
    <span class="material-symbols-outlined">person</span>
    <span class="font-medium text-sm">Profile</span>
  </a>
{% endblock %}

{% block content %}
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
    <div class="lg:col-span-8 space-y-6">
      <div class="bg-white dark:bg-[#151b2b] rounded-2xl border border-[#dbdfe6] dark:border-white/10 shadow-soft overflow-hidden">
        <div class="p-6 flex items-center justify-between border-b border-[#dbdfe6] dark:border-white/10">
          <div>
            <h3 class="font-bold text-lg">Attendance History</h3>
            <p class="text-xs text-[#616f89] uppercase">{{ current_month }}</p>
          </div>
          <div class="flex items-center gap-2">
            <a href="{{ prev_link }}" class="size-9 flex items-center justify-center rounded-lg border border-[#dbdfe6] hover:bg-gray-50 transition-colors"><span class="material-symbols-outlined text-lg">chevron_left</span></a>
            <a href="{% url 'student:attendance' %}" class="size-9 flex items-center justify-center rounded-lg border border-[#dbdfe6] hover:bg-gray-50 transition-colors"><span class="material-symbols-outlined text-lg">today</span></a>
            <a href="{{ next_link }}" class="size-9 flex items-center justify-center rounded-lg border border-[#dbdfe6] hover:bg-gray-50 transition-colors"><span class="material-symbols-outlined text-lg">chevron_right</span></a>
          </div>
        </div>

        <div class="p-6">
          <div class="grid grid-cols-7 mb-4">
            <span class="text-center text-xs font-bold text-[#616f89]">SUN</span>
            <span class="text-center text-xs font-bold text-[#616f89]">MON</span>
            <span class="text-center text-xs font-bold text-[#616f89]">TUE</span>
            <span class="text-center text-xs font-bold text-[#616f89]">WED</span>
            <span class="text-center text-xs font-bold text-[#616f89]">THU</span>
            <span class="text-center text-xs font-bold text-[#616f89]">FRI</span>
            <span class="text-center text-xs font-bold text-[#616f89]">SAT</span>
          </div>

          <div class="grid grid-cols-7 gap-4">
            {% for date in calendar_data %}
              {% if date.day == 0 %}
                <div class="h-14"></div>
              {% elif date.status == 'present' %}
                <div class="h-14 flex flex-col items-center justify-center rounded-xl bg-green-50 border border-green-100">
                  <span class="font-bold text-sm text-[#111318]">{{ date.day }}</span>
                  <div class="mt-1 size-1.5 bg-green-500 rounded-full"></div>
                </div>
              {% elif date.status == 'absent' %}
                <div class="h-14 flex flex-col items-center justify-center rounded-xl bg-red-50 border border-red-100">
                  <span class="font-bold text-sm text-red-600">{{ date.day }}</span>
                  <div class="mt-1 size-1.5 bg-red-500 rounded-full"></div>
                </div>
              {% else %}
                <div class="h-14 flex items-center justify-center rounded-xl text-gray-400 text-sm">{{ date.day }}</div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <div class="lg:col-span-4 space-y-6">
      <div class="bg-white dark:bg-[#151b2b] rounded-2xl border border-[#dbdfe6] dark:border-white/10 shadow-soft p-6 flex flex-col items-center justify-center">
        <h3 class="font-bold text-lg mb-4 w-full">Overall Performance</h3>
        <div class="relative flex items-center justify-center py-4">
          <svg class="size-56 transform -rotate-90">
            <circle class="text-[#dbdfe6]" cx="112" cy="112" fill="transparent" r="96" stroke="currentColor" stroke-width="14"></circle>
            <circle class="text-primary transition-all duration-1000 ease-out" cx="112" cy="112" fill="transparent" r="96" stroke="currentColor" stroke-dasharray="603" stroke-dashoffset="{{ dash_offset }}" stroke-width="14" stroke-linecap="round"></circle>
          </svg>
          <div class="absolute inset-0 flex flex-col items-center justify-center">
            <span class="text-5xl font-bold tracking-tight">{{ percentage }}%</span>
            <span class="text-sm font-medium text-[#616f89] mt-1">Total Attendance</span>
          </div>
        </div>
        <div class="mt-4 text-center">
          <p class="text-sm text-[#616f89]">
            You have attended <span class="text-primary font-bold">{{ present_classes }}</span> out of {{ total_classes }} classes.
          </p>
        </div>
      </div>

      <div class="bg-transparent">
        <h3 class="text-lg font-bold mb-4 px-1">Subject Breakdown</h3>
        <div class="space-y-3">
          {% for sub in subjects %}
            <div class="bg-white dark:bg-[#151b2b] p-4 rounded-xl border border-[#dbdfe6] shadow-sm">
              <div class="flex justify-between items-start mb-3">
                <div class="flex items-center gap-3">
                  <div class="size-10 rounded-lg {% if sub.percentage >= 75 %}
                      
                      
                      
                      bg-green-50 text-green-600



                    {% else %}
                      
                      
                      
                      bg-red-50 text-red-600



                    {% endif %} flex items-center justify-center">
                    <span class="material-symbols-outlined">
                      {% if sub.percentage >= 75 %}
                        check_circle
                      {% else %}
                        warning
                      {% endif %}
                    </span>
                  </div>
                  <div>
                    <p class="font-bold text-sm">{{ sub.name }}</p>
                    <p class="text-xs text-[#616f89]">{{ sub.professor }}</p>
                  </div>
                </div>
                <div class="text-right">
                  <span class="text-sm font-bold {% if sub.percentage >= 75 %}
                      
                      
                      
                      text-green-600



                    {% else %}
                      
                      
                      
                      text-red-600



                    {% endif %}">
                    {{ sub.percentage }}%
                  </span>
                  <p class="text-[10px] text-[#616f89] uppercase tracking-wider">{{ sub.present }}/{{ sub.total }}</p>
                </div>
              </div>
              <div class="h-1.5 bg-[#dbdfe6] rounded-full overflow-hidden">
                <div class="h-full {% if sub.percentage >= 75 %}
                    
                    
                    
                    bg-green-500



                  {% else %}
                    
                    
                    
                    bg-red-500



                  {% endif %} rounded-full"
                  style="width: {{ sub.percentage }}%;"></div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}
